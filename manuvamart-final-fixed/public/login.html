<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - ManuvaMarket</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      background-color: #121212;
      color: #f5f5f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .gradient-text {
      background: linear-gradient(90deg, #00c6ff, #92effd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .btn-primary {
      background: linear-gradient(90deg, #00c6ff, #0072ff);
      color: white;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 198, 255, 0.3);
    }
    .form-input {
      background-color: #1e1e1e;
      border: 1px solid #333;
      color: #f5f5f5;
      transition: all 0.3s ease;
    }
    .form-input:focus {
      border-color: #00c6ff;
      box-shadow: 0 0 0 2px rgba(0, 198, 255, 0.2);
    }
    .card {
      background-color: #1e1e1e;
      border: 1px solid #333;
    }
    .hero-pattern {
      background-color: #0a0a0a;
      background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23222222' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
    }
  </style>
</head>
<body>
  <div class="min-h-screen flex flex-col lg:flex-row">
    <!-- Left Panel - Form -->
    <div class="lg:w-1/2 flex flex-col px-6 py-12 lg:px-16">
      <div class="mb-10">
        <a href="/" class="text-2xl font-bold gradient-text">ManuvaMarket</a>
        <p class="text-gray-500 mt-2">Premium Digital Products Marketplace</p>
      </div>

      <div class="flex-1 flex flex-col justify-center max-w-md mx-auto w-full">
        <div class="text-center mb-10">
          <h1 class="text-3xl font-bold">Welcome Back</h1>
          <p class="text-gray-400 mt-2">Sign in to your account to continue</p>
        </div>
        
        <div class="tabs flex justify-center mb-8">
          <button id="login-tab" class="px-6 py-2 text-lg border-b-2 border-blue-500 text-white font-medium">Login</button>
          <button id="register-tab" class="px-6 py-2 text-lg border-b-2 border-transparent text-gray-400 font-medium hover:text-gray-300">Register</button>
        </div>
        
        <!-- Login Form -->
        <form id="login-form" class="space-y-6">
          <div>
            <label for="login-username" class="block text-gray-400 mb-2">Username</label>
            <input 
              type="text" 
              id="login-username" 
              class="form-input w-full px-4 py-3 rounded-lg focus:outline-none" 
              placeholder="Enter your username"
              required
            >
          </div>
          
          <div>
            <label for="login-password" class="block text-gray-400 mb-2">Password</label>
            <input 
              type="password" 
              id="login-password" 
              class="form-input w-full px-4 py-3 rounded-lg focus:outline-none" 
              placeholder="Enter your password"
              required
            >
          </div>
          
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <input type="checkbox" id="remember-me" class="h-4 w-4 bg-gray-800 border-gray-600 rounded">
              <label for="remember-me" class="ml-2 text-sm text-gray-400">Remember me</label>
            </div>
            
            <a href="#" class="text-sm text-blue-400 hover:text-blue-300">Forgot password?</a>
          </div>
          
          <div>
            <button 
              type="submit" 
              id="login-btn"
              class="btn-primary w-full py-3 rounded-lg text-white font-medium"
            >
              Sign In
            </button>
          </div>
        </form>
        
        <!-- Register Form (Hidden by default) -->
        <form id="register-form" class="space-y-6 hidden">
          <div>
            <label for="register-username" class="block text-gray-400 mb-2">Username</label>
            <input 
              type="text" 
              id="register-username" 
              class="form-input w-full px-4 py-3 rounded-lg focus:outline-none" 
              placeholder="Choose a username"
              required
            >
          </div>
          
          <div>
            <label for="register-email" class="block text-gray-400 mb-2">Email</label>
            <input 
              type="email" 
              id="register-email" 
              class="form-input w-full px-4 py-3 rounded-lg focus:outline-none" 
              placeholder="Enter your email"
              required
            >
          </div>
          
          <div>
            <label for="register-password" class="block text-gray-400 mb-2">Password</label>
            <input 
              type="password" 
              id="register-password" 
              class="form-input w-full px-4 py-3 rounded-lg focus:outline-none" 
              placeholder="Choose a password"
              required
            >
          </div>
          
          <div>
            <label for="register-confirm-password" class="block text-gray-400 mb-2">Confirm Password</label>
            <input 
              type="password" 
              id="register-confirm-password" 
              class="form-input w-full px-4 py-3 rounded-lg focus:outline-none" 
              placeholder="Confirm your password"
              required
            >
          </div>
          
          <div class="flex items-center">
            <input type="checkbox" id="agree-terms" class="h-4 w-4 bg-gray-800 border-gray-600 rounded" required>
            <label for="agree-terms" class="ml-2 text-sm text-gray-400">
              I agree to the <a href="#" class="text-blue-400 hover:text-blue-300">Terms of Service</a> and <a href="#" class="text-blue-400 hover:text-blue-300">Privacy Policy</a>
            </label>
          </div>
          
          <div>
            <button 
              type="submit" 
              id="register-btn"
              class="btn-primary w-full py-3 rounded-lg text-white font-medium"
            >
              Create Account
            </button>
          </div>
        </form>
      </div>
      
      <div class="mt-12 text-center text-gray-500 text-sm">
        &copy; 2023 ManuvaMarket. All rights reserved.
      </div>
    </div>
    
    <!-- Right Panel - Hero -->
    <div class="hidden lg:block lg:w-1/2 hero-pattern">
      <div class="h-full flex flex-col justify-center px-12 bg-gradient-to-r from-black to-transparent">
        <div class="max-w-xl">
          <h2 class="text-4xl font-bold mb-6">Premium Digital Products Marketplace</h2>
          <p class="text-xl text-gray-300 mb-8">
            Access the most reliable marketplace for high-quality digital products. Verified sellers, secure transactions, and instant delivery.
          </p>
          
          <div class="space-y-4">
            <div class="flex items-center">
              <div class="rounded-full bg-blue-500 bg-opacity-20 p-2 mr-4">
                <i class="fas fa-shield-alt text-blue-400"></i>
              </div>
              <p class="text-gray-300">100% secure and anonymous transactions</p>
            </div>
            
            <div class="flex items-center">
              <div class="rounded-full bg-blue-500 bg-opacity-20 p-2 mr-4">
                <i class="fas fa-bolt text-blue-400"></i>
              </div>
              <p class="text-gray-300">Instant delivery after payment</p>
            </div>
            
            <div class="flex items-center">
              <div class="rounded-full bg-blue-500 bg-opacity-20 p-2 mr-4">
                <i class="fas fa-check-circle text-blue-400"></i>
              </div>
              <p class="text-gray-300">All products verified and tested</p>
            </div>
            
            <div class="flex items-center">
              <div class="rounded-full bg-blue-500 bg-opacity-20 p-2 mr-4">
                <i class="fas fa-headset text-blue-400"></i>
              </div>
              <p class="text-gray-300">24/7 customer support</p>
            </div>
          </div>
          
          <div class="mt-12">
            <p class="text-gray-400 italic">
              "The best marketplace I've found for digital products. Fast, secure, and reliable."
            </p>
            <p class="text-gray-500 mt-2">â€” James S., Verified Customer</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tab switching functionality
    const loginTab = document.getElementById('login-tab');
    const registerTab = document.getElementById('register-tab');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    
    loginTab.addEventListener('click', () => {
      loginTab.classList.add('border-blue-500', 'text-white');
      registerTab.classList.remove('border-blue-500', 'text-white');
      loginTab.classList.remove('border-transparent', 'text-gray-400');
      registerTab.classList.add('border-transparent', 'text-gray-400');
      
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
    });
    
    registerTab.addEventListener('click', () => {
      registerTab.classList.add('border-blue-500', 'text-white');
      loginTab.classList.remove('border-blue-500', 'text-white');
      registerTab.classList.remove('border-transparent', 'text-gray-400');
      loginTab.classList.add('border-transparent', 'text-gray-400');
      
      registerForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
    });
    
    // Login form submission
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      
      try {
        console.log('Attempting login for:', username);
        
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        console.log('Login response:', response.status);
        
        if (response.ok) {
          // Successful login
          console.log('Login successful, saving user data');
          localStorage.setItem('user', JSON.stringify(data.user));
          
          // Add a small delay to ensure the localStorage is updated
          setTimeout(() => {
            console.log('Redirecting to home page');
            window.location.href = '/home.html'; // Redirect to home page
          }, 100);
        } else {
          // Failed login
          console.error('Login failed:', data.message);
          alert(data.message || 'Login failed. Please check your credentials.');
        }
      } catch (error) {
        console.error('Login error:', error);
        alert('An error occurred during login. Please try again.');
      }
    });
    
    // Registration form submission
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('register-username').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm-password').value;
      
      // Validate password match
      if (password !== confirmPassword) {
        alert('Passwords do not match.');
        return;
      }
      
      try {
        console.log('Sending registration data:', {
          username,
          email,
          password,
          fullName: username // Using username as fullName for simplicity
        });
        
        const response = await fetch('/api/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username,
            email,
            password,
            fullName: username, // Using username as fullName for simplicity
            role: 'user'
          })
        });
        
        const data = await response.json();
        console.log('Registration response:', data, 'Status:', response.status);
        
        if (response.ok) {
          // Successful registration - show success message and switch to login tab
          alert('Registration successful! Please log in with your credentials.');
          
          // Clear registration form
          document.getElementById('register-username').value = '';
          document.getElementById('register-email').value = '';
          document.getElementById('register-password').value = '';
          document.getElementById('register-confirm-password').value = '';
          
          // Switch to login tab
          loginTab.click();
          
          // Pre-fill the login form with the username for convenience
          document.getElementById('login-username').value = username;
        } else {
          // Failed registration
          alert(data.message || 'Registration failed. Please try again.');
        }
      } catch (error) {
        console.error('Registration error:', error);
        alert('An error occurred during registration. Please try again.');
      }
    });
  </script>
</body>
</html>